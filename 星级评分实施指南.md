# Moodleé—®å·æ’ä»¶æ·»åŠ æ˜Ÿçº§è¯„åˆ†é¢˜å‹ - å¿«é€Ÿå®æ–½æŒ‡å—

## ç®€ä»‹

æœ¬æŒ‡å—å¸®åŠ©æ‚¨åœ¨Moodleçš„é—®å·(questionnaire)æ’ä»¶ä¸­æ·»åŠ ç±»ä¼¼æ·˜å®çš„æ˜Ÿçº§è¯„åˆ†é¢˜å‹ã€‚

## å·²åˆ›å»ºçš„æ–‡ä»¶

âœ… ä»¥ä¸‹æ–‡ä»¶å·²ç»åˆ›å»ºå¥½,æ— éœ€æ‰‹åŠ¨åˆ›å»º:

1. `mod/questionnaire/classes/question/starrating.php` - æ˜Ÿçº§è¯„åˆ†é¢˜å‹æ ¸å¿ƒç±»
2. `mod/questionnaire/templates/question_starrating.mustache` - é—®é¢˜æ˜¾ç¤ºæ¨¡æ¿
3. `mod/questionnaire/templates/response_starrating.mustache` - ç­”æ¡ˆæ˜¾ç¤ºæ¨¡æ¿  
4. `mod/questionnaire/styles_starrating.css` - æ ·å¼æ–‡ä»¶
5. `mod/questionnaire/javascript/starrating.js` - JavaScriptäº¤äº’è„šæœ¬
6. `mod/questionnaire/STARRATING_IMPLEMENTATION_GUIDE.md` - è¯¦ç»†è‹±æ–‡æŒ‡å—

## éœ€è¦æ‰‹åŠ¨ä¿®æ”¹çš„æ–‡ä»¶

### 1. ä¿®æ”¹ `classes/question/question.php`

åœ¨ç¬¬42è¡Œå·¦å³,æ·»åŠ æ–°çš„é¢˜å‹å¸¸é‡å®šä¹‰:

```php
define('QUESSLIDER', 11);
define('QUESSTARRATING', 12);  // â† æ·»åŠ è¿™ä¸€è¡Œ
define('QUESPAGEBREAK', 99);
```

åœ¨ç¬¬117è¡Œå·¦å³çš„ `$qtypenames` æ•°ç»„ä¸­æ·»åŠ :

```php
private static $qtypenames = [
    QUESYESNO => 'yesno',
    QUESTEXT => 'text',
    QUESESSAY => 'essay',
    QUESRADIO => 'radio',
    QUESCHECK => 'check',
    QUESDROP => 'drop',
    QUESRATE => 'rate',
    QUESDATE => 'date',
    QUESNUMERIC => 'numerical',
    QUESPAGEBREAK => 'pagebreak',
    QUESSECTIONTEXT => 'sectiontext',
    QUESSLIDER => 'slider',
    QUESSTARRATING => 'starrating',  // â† æ·»åŠ è¿™ä¸€è¡Œ
];
```

### 2. ä¿®æ”¹ `locallib.php`

åœ¨ `questionnaire_get_type()` å‡½æ•°ä¸­(çº¦478è¡Œ),æ·»åŠ æ–°çš„case:

```php
function questionnaire_get_type ($id) {
    switch ($id) {
        case 1:
            return get_string('yesno', 'questionnaire');
        // ... å…¶ä»–case ...
        case 11:
            return get_string('slider', 'questionnaire');
        case 12:  // â† æ·»åŠ è¿™3è¡Œ
            return get_string('starrating', 'questionnaire');
        case 100:
            return get_string('sectiontext', 'questionnaire');
        // ... åç»­ä»£ç  ...
    }
}
```

### 3. ä¿®æ”¹è¯­è¨€æ–‡ä»¶ `lang/en/questionnaire.php`

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ :

```php
$string['starrating'] = 'Star Rating';
$string['starrating_help'] = 'Display a star rating question where users can rate items using stars (like Taobao rating system).';
$string['starrating_link'] = 'mod/questionnaire/questions#Star_Rating';
$string['maxstars'] = 'Maximum number of stars';
$string['maxstars_help'] = 'Select the maximum number of stars to display (3-10 stars). Default is 5 stars.';
```

### 4. (å¯é€‰)åˆ›å»ºä¸­æ–‡è¯­è¨€æ–‡ä»¶ `lang/zh_cn/questionnaire.php`

å¦‚æœéœ€è¦ä¸­æ–‡æ”¯æŒ,åˆ›å»ºæˆ–ä¿®æ”¹æ­¤æ–‡ä»¶:

```php
<?php
$string['starrating'] = 'æ˜Ÿçº§è¯„åˆ†';
$string['starrating_help'] = 'æ˜¾ç¤ºæ˜Ÿçº§è¯„åˆ†é—®é¢˜,ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ˜Ÿæ˜Ÿå¯¹é¡¹ç›®è¿›è¡Œè¯„åˆ†(ç±»ä¼¼æ·˜å®è¯„åˆ†ç³»ç»Ÿ)ã€‚';
$string['starrating_link'] = 'mod/questionnaire/questions#Star_Rating';
$string['maxstars'] = 'æœ€å¤šæ˜Ÿæ•°';
$string['maxstars_help'] = 'é€‰æ‹©è¦æ˜¾ç¤ºçš„æœ€å¤§æ˜Ÿæ•°(3-10é¢—æ˜Ÿ)ã€‚é»˜è®¤ä¸º5é¢—æ˜Ÿã€‚';
```

### 5. ä¿®æ”¹ `db/install.php`

åœ¨å®‰è£…å‡½æ•°ä¸­æ·»åŠ é¢˜å‹è®°å½•:

```php
function xmldb_questionnaire_install() {
    global $DB;
    
    // åœ¨ç°æœ‰ä»£ç åæ·»åŠ 
    $DB->insert_record('questionnaire_question_type', [
        'typeid' => 12,
        'type' => 'Star Rating',
        'has_choices' => 'y',
        'response_table' => 'response_rank'
    ]);
    
    return true;
}
```

å¦‚æœæ’ä»¶å·²å®‰è£…,å¯ä»¥æ‰‹åŠ¨åœ¨æ•°æ®åº“æ‰§è¡Œ:

```sql
INSERT INTO mdl_questionnaire_question_type (typeid, type, has_choices, response_table) 
VALUES (12, 'Star Rating', 'y', 'response_rank');
```

### 6. ä¿®æ”¹ `tests/behat/behat_mod_questionnaire.php`

åœ¨çº¦109è¡Œçš„ `$validtypes` æ•°ç»„ä¸­æ·»åŠ :

```php
$validtypes = array(
    '----- Page Break -----',
    'Check Boxes',
    'Date',
    'Dropdown Box',
    'Essay Box',
    'Label',
    'Numeric',
    'Radio Buttons',
    'Rate (scale 1..5)',
    'Text Box',
    'Yes/No',
    'Slider',
    'Star Rating');  // â† æ·»åŠ è¿™ä¸€è¡Œ
```

## å®æ–½æ­¥éª¤

1. **å¤‡ä»½æ•°æ®**
   - å¤‡ä»½æ•°æ®åº“
   - å¤‡ä»½ä»£ç æ–‡ä»¶

2. **åº”ç”¨ä¿®æ”¹**
   - æŒ‰ç…§ä¸Šè¿°è¯´æ˜ä¿®æ”¹6ä¸ªæ–‡ä»¶
   - ç¡®ä¿æ‰€æœ‰åˆ›å»ºçš„æ–‡ä»¶éƒ½åœ¨æ­£ç¡®ä½ç½®

3. **æ›´æ–°æ•°æ®åº“**
   - åœ¨æ•°æ®åº“ä¸­æ·»åŠ é¢˜å‹è®°å½•(æ­¥éª¤5)
   - æˆ–å‡çº§æ’ä»¶ç‰ˆæœ¬è§¦å‘å®‰è£…è„šæœ¬

4. **æ¸…é™¤ç¼“å­˜**
   ```bash
   # æ–¹å¼1: é€šè¿‡ç®¡ç†ç•Œé¢
   ç½‘ç«™ç®¡ç† > å¼€å‘ > æ¸…é™¤æ‰€æœ‰ç¼“å­˜
   
   # æ–¹å¼2: é€šè¿‡å‘½ä»¤è¡Œ
   php admin/cli/purge_caches.php
   ```

5. **æµ‹è¯•åŠŸèƒ½**
   - åˆ›å»ºä¸€ä¸ªæµ‹è¯•é—®å·
   - æ·»åŠ æ˜Ÿçº§è¯„åˆ†é¢˜ç›®
   - å¡«å†™å¹¶æäº¤é—®å·
   - æŸ¥çœ‹ç­”æ¡ˆç»Ÿè®¡

## ä½¿ç”¨ç¤ºä¾‹

åˆ›å»ºæ˜Ÿçº§è¯„åˆ†é¢˜ç›®:

1. è¿›å…¥é—®å·ç¼–è¾‘é¡µé¢
2. ç‚¹å‡»"æ·»åŠ é—®é¢˜"
3. é€‰æ‹©"Star Rating"
4. å¡«å†™é…ç½®:
   - **é—®é¢˜åç§°**: Q1
   - **é—®é¢˜æ–‡æœ¬**: è¯·å¯¹ä»¥ä¸‹æœåŠ¡è¿›è¡Œè¯„åˆ†
   - **æœ€å¤šæ˜Ÿæ•°**: 5
   - **å¯èƒ½çš„ç­”æ¡ˆ**(æ¯è¡Œä¸€ä¸ª):
     ```
     å•†å“è´¨é‡
     ç‰©æµé€Ÿåº¦  
     å®¢æœæ€åº¦
     æ•´ä½“æ»¡æ„åº¦
     ```
5. ä¿å­˜

## æ•ˆæœé¢„è§ˆ

ç”¨æˆ·çœ‹åˆ°çš„ç•Œé¢:

```
è¯·å¯¹ä»¥ä¸‹æœåŠ¡è¿›è¡Œè¯„åˆ† *

å•†å“è´¨é‡
â˜†â˜†â˜†â˜†â˜† (0/5)

ç‰©æµé€Ÿåº¦
â˜†â˜†â˜†â˜†â˜† (0/5)

å®¢æœæ€åº¦
â˜†â˜†â˜†â˜†â˜† (0/5)

æ•´ä½“æ»¡æ„åº¦
â˜†â˜†â˜†â˜†â˜† (0/5)
```

ç‚¹å‡»æ˜Ÿæ˜Ÿå:

```
å•†å“è´¨é‡
â˜…â˜…â˜…â˜…â˜† (4/5)
```

## æ–‡ä»¶å¯¹ç…§è¡¨

| åºå· | æ–‡ä»¶è·¯å¾„ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|------|------|
| 1 | `classes/question/starrating.php` | âœ… å·²åˆ›å»º | é¢˜å‹æ ¸å¿ƒç±» |
| 2 | `classes/question/question.php` | â³ éœ€ä¿®æ”¹ | æ·»åŠ å¸¸é‡å®šä¹‰ |
| 3 | `locallib.php` | â³ éœ€ä¿®æ”¹ | æ·»åŠ ç±»å‹åç§° |
| 4 | `lang/en/questionnaire.php` | â³ éœ€ä¿®æ”¹ | è‹±æ–‡è¯­è¨€åŒ… |
| 5 | `lang/zh_cn/questionnaire.php` | â³ éœ€åˆ›å»º | ä¸­æ–‡è¯­è¨€åŒ…(å¯é€‰) |
| 6 | `templates/question_starrating.mustache` | âœ… å·²åˆ›å»º | é—®é¢˜æ˜¾ç¤ºæ¨¡æ¿ |
| 7 | `templates/response_starrating.mustache` | âœ… å·²åˆ›å»º | ç­”æ¡ˆæ˜¾ç¤ºæ¨¡æ¿ |
| 8 | `styles_starrating.css` | âœ… å·²åˆ›å»º | CSSæ ·å¼ |
| 9 | `javascript/starrating.js` | âœ… å·²åˆ›å»º | JavaScriptè„šæœ¬ |
| 10 | `db/install.php` | â³ éœ€ä¿®æ”¹ | æ•°æ®åº“å®‰è£… |
| 11 | `tests/behat/behat_mod_questionnaire.php` | â³ éœ€ä¿®æ”¹ | æµ‹è¯•é…ç½® |

## å¸¸è§é—®é¢˜

### Q1: æ˜Ÿæ˜Ÿä¸æ˜¾ç¤º?
**A**: ç¡®ä¿MoodleåŠ è½½äº†Font Awesomeå›¾æ ‡åº“ã€‚æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰CSSåŠ è½½é”™è¯¯ã€‚

### Q2: ç‚¹å‡»æ˜Ÿæ˜Ÿæ²¡ååº”?
**A**: æ£€æŸ¥JavaScriptæ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½ã€‚æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ã€‚

### Q3: æ•°æ®åº“é”™è¯¯?
**A**: ç¡®ä¿åœ¨ `questionnaire_question_type` è¡¨ä¸­æ·»åŠ äº†ç±»å‹è®°å½•ã€‚

### Q4: æ‰¾ä¸åˆ°"Star Rating"é€‰é¡¹?
**A**: ç¡®ä¿å·²æ¸…é™¤ç¼“å­˜,å¹¶æ£€æŸ¥è¯­è¨€æ–‡ä»¶æ˜¯å¦æ­£ç¡®é…ç½®ã€‚

### Q5: å¦‚ä½•ä¿®æ”¹æ˜Ÿæ˜Ÿé¢œè‰²?
**A**: ç¼–è¾‘ `styles_starrating.css` æ–‡ä»¶,ä¿®æ”¹ `.star-selected` çš„ `color` å±æ€§ã€‚

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶çš„æ£€æŸ¥æ¸…å•:

- [ ] æ‰€æœ‰æ–‡ä»¶éƒ½å·²åˆ›å»º/ä¿®æ”¹
- [ ] æ•°æ®åº“è®°å½•å·²æ·»åŠ 
- [ ] ç¼“å­˜å·²æ¸…é™¤
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— é”™è¯¯
- [ ] PHPé”™è¯¯æ—¥å¿—æ— å¼‚å¸¸
- [ ] åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯

## ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. âœ¨ æ·»åŠ åŠæ˜Ÿè¯„åˆ†æ”¯æŒ
2. ğŸ¨ è‡ªå®šä¹‰æ˜Ÿæ˜Ÿé¢œè‰²å’Œå¤§å°
3. ğŸ“Š å¢å¼ºæ•°æ®ç»Ÿè®¡å’ŒæŠ¥è¡¨åŠŸèƒ½
4. ğŸ“± ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸ä½“éªŒ
5. ğŸŒ æ·»åŠ æ›´å¤šè¯­è¨€æ”¯æŒ
6. â™¿ å¢å¼ºæ— éšœç¢è®¿é—®æ”¯æŒ

## ç‰ˆæƒä¿¡æ¯

æ­¤å®ç°éµå¾ª GNU GPL v3 æˆ–æ›´é«˜ç‰ˆæœ¬è®¸å¯è¯ã€‚
