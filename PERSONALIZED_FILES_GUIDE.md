# 个性化问卷调查功能使用指南

## 功能概述

个性化问卷调查功能允许每个学生在填写问卷时只看到属于自己的附件(通常是图片)。这对于需要学生对个人照片或其他隐私性资料进行投票表决的场景非常有用。

## 主要特性

1. **个性化附件显示**:每个学生只能看到以自己学号命名的附件
2. **批量导入**:支持批量上传多个学生的附件
3. **隐私保护**:学生之间无法看到彼此的附件
4. **灵活管理**:教师可以随时添加、更新或删除学生的个性化附件

## 使用步骤

### 1. 启用个性化附件功能

1. 创建或编辑问卷调查活动
2. 在设置页面中,勾选"Enable personalized files"(启用个性化附件)
3. 保存设置

### 2. 准备附件文件

1. 准备学生的个性化附件(建议使用图片格式:jpg, png等)
2. **重要**:将每个附件文件以对应学生的学号命名,例如:
   - `20231001.jpg` - 学号为20231001的学生的附件
   - `20231002.png` - 学号为20231002的学生的附件
   - `20231003.jpg` - 学号为20231003的学生的附件

> **注意**: 文件名必须与学生的学号(idnumber)完全一致,不包括扩展名

### 3. 批量上传附件

1. 进入问卷调查活动
2. 点击"Manage personalized files"(管理个性化附件)标签页
3. 点击"Choose files"(选择文件)按钮
4. 选择所有准备好的附件文件
5. 点击"Upload"(上传)按钮

系统会自动:
- 根据文件名匹配对应的学生
- 检查学生是否在课程中注册
- 为每个学生保存其专属附件

### 4. 管理已上传的附件

在"Manage personalized files"页面中,你可以:
- 查看所有已上传的附件列表
- 查看每个附件对应的学号和学生姓名
- 删除不需要的附件
- 更新已有附件(上传同学号的新文件会自动替换旧文件)

### 5. 学生填写问卷

当学生访问问卷调查时:
1. 系统会自动查找该学生的个性化附件
2. 如果找到,会在问卷顶部显示附件图片
3. 学生根据自己看到的附件内容填写问卷
4. 学生无法看到其他同学的附件

## 应用场景示例

### 场景1: 个人照片审核
- 每个学生需要对自己提交的证件照进行确认
- 教师批量上传所有学生的照片(以学号命名)
- 学生登录后只能看到自己的照片,并确认是否符合要求

### 场景2: 个性化作品评价
- 学生对自己的作品进行自我评价
- 教师上传每个学生的作品图片
- 学生看到自己的作品后进行评分和反思

### 场景3: 隐私性问卷调查
- 涉及个人隐私的调查问卷
- 需要向每个人展示不同的内容
- 确保信息不被其他人看到

## 技术要求

### 文件要求
- 支持的文件格式:图片文件(jpg, png, gif等)
- 文件命名:必须使用学生的学号(不含扩展名)
- 文件大小:遵循课程的最大文件大小限制

### 权限要求
- 教师需要有"mod/questionnaire:manage"权限才能上传和管理附件
- 学生需要有"mod/questionnaire:view"权限才能查看问卷和自己的附件

## 常见问题

### Q1: 上传文件后显示"Student not found"错误
**A**: 检查文件名是否与学生的学号(idnumber)完全一致。可以在用户管理中查看学生的准确学号。

### Q2: 学生看不到附件
**A**: 可能的原因:
- 该学生的附件尚未上传
- 文件名与学号不匹配
- 学生不在课程中注册

### Q3: 如何更新已上传的附件?
**A**: 直接上传同名文件即可,系统会自动替换旧文件。

### Q4: 学生能看到其他人的附件吗?
**A**: 不能。系统通过严格的权限检查,确保学生只能看到自己的附件。

## 数据库变更

本功能会在数据库中添加以下内容:

1. **questionnaire_personal_file表**: 存储个性化附件记录
2. **questionnaire表新字段**: personalfileenabled (是否启用个性化附件)

## 升级注意事项

如果你是从旧版本升级:
1. 运行数据库升级脚本会自动创建新表和字段
2. 现有问卷的个性化附件功能默认关闭
3. 需要手动编辑问卷设置来启用此功能

## 安全性说明

- 附件只能由有管理权限的教师查看和管理
- 学生只能查看自己的附件,无法访问其他学生的附件
- 所有文件访问都经过Moodle的权限系统验证
- 文件存储在Moodle的标准文件系统中,受到相同的安全保护

## 开发信息

- 版本: 1.0
- 兼容性: Moodle 4.1+
- 模块: mod_questionnaire
